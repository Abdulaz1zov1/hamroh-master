<style>
    .alerting {
        display: none;
        position: fixed;
        top: 25%;
        left: 15%;
        right: 15%;
        width: 70%;
        z-index: 100000;
    }
</style>



<!-- malumot notogri qoshilganda chiqadigan ogohlantirish -->
<div class="col-xl-6 alert-warning  alerting" id="false_Put_Content">
    <div class="card m-b-30 alert-warning ">
        <div class="card-body alert-warning ">
            <div class="alert-warning">
                <div class="alert alert-warning mb-0" role="alert">
                    <h4 class="text-dark alert-heading mt-0 font-18 mt-3">Hurmatli foydalanuvchi</h4>
                    <p class="text-dark">Ushbu holatda barcha qismlarni to'ldirib chiqishingiz kerak. Aks holda malumot
                        qo'shilmaydi</p>


                    <button type="button" onclick="closeWarning()" class="form-control mt-3">
                        Yopish
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- malumot yaratilganda chiqadigan xabar -->
<div class="col-xl-6 alert-warning  alerting" id="create_success">
    <div class="card m-b-30 alert-warning ">
        <div class="card-body alert-warning ">
            <div class="alert-warning">
                <div class="alert alert-warning mb-0" role="alert">
                    <h4 class="text-dark alert-heading mt-0 font-18 mt-3">Hurmatli foydalanuvchi</h4>
                    <p class="text-dark">Tabriklaymiz. Yangi malumot yaratdingiz</p>
                    <button type="button" onclick="closeWarning()" class="form-control mt-3">
                        Yopish
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- malumot o'chirilgani haqida xabar-->
<div class="col-xl-6 alert-warning  alerting" id="delete_success">
    <div class="card m-b-30 alert-warning ">
        <div class="card-body alert-warning ">
            <div class="alert-warning">
                <div class="alert alert-warning mb-0" role="alert">
                    <h4 class="text-dark alert-heading mt-0 font-18 mt-3">Hurmatli foydalanuvchi</h4>
                    <p class="text-dark">Tabriklaymiz.Ushbu malumot muvaffaqiyatli o'chirildi</p>
                    <button type="button" onclick="closeWarning()" class="form-control mt-3">
                        Yopish
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- malumot tahrirlangani haqida malumot berish -->
<div class="col-xl-6 alert-warning  alerting" id="update_success">
    <div class="card m-b-30 alert-warning ">
        <div class="card-body alert-warning ">
            <div class="alert-warning">
                <div class="alert alert-warning mb-0" role="alert">
                    <h4 class="text-dark alert-heading mt-0 font-18 mt-3">Hurmatli foydalanuvchi</h4>
                    <p class="text-dark">Tabriklaymiz.Ushbu malumot muvaffaqiyatli tahrirlandi</p>
                    <button type="button" onclick="closeWarning()" class="form-control mt-3">
                        Yopish
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>















<div class="page-title-box">
    <div class="row align-items-center">
        <div class="col-sm-6">
            <h4 class="page-title">Yangi buyurtmalar ro'yhati</h4>
        </div>
        <div class="col-sm-6">
            <ol class="breadcrumb float-right">
                <li class="breadcrumb-item">
                    <a href="/admin/active" class="text-light btn btn-primary waves-effect waves-light" >Qabul qilingan buyurtmalar</a>
                </li>
            </ol>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12">
        <div class="card m-b-30">
            <div class="card-body">

                <table id="datatable-buttons"
                    class="table table-striped table-bordered dt-responsive nowrap text-center"
                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                    <thead>
                        <tr>
                            <th>Foydalanuvchi ismi </th>
                            <th>Buyurtma raqami </th>
                            <th>Buyurtma tekshirilganmi </th>
                            <th>Sozlama</th>
                        </tr>
                    </thead>
                    <tbody class="select_group">
                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>



















<!-- -----------------   Order haqida malumot olish uchun modal  -----------------  -->
<div class="modal fade bs-example-modal-lg" id="largesizemodal_inform" tabindex="-1" role="dialog"
    aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title mt-0" id="myLargeModalLabel">Buyurtma haqida malumot olish</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="largesizemodal_inform_child">

            </div>


        </div>
    </div>
</div>

<div class="modal fade bs-example-modal-lg" id="lordered_product_inform" tabindex="-1" role="dialog"
    aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title mt-0" id="myLargeModalLabel">Buyurtma berilgan mahsulotlar</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="ordered_product_table">
            </div>


        </div>
    </div>
</div>


<div class="modal fade bs-example-modal-lg" id="mahsulot_modal" tabindex="-1" role="dialog"
    aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title mt-0" id="myLargeModalLabel">Mahsulot haqida malumot</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="mahsulot_modal_child">
            </div>
        </div>
    </div>
</div>


<div class="modal fade bs-example-modal-lg" id="order_view" tabindex="-1" role="dialog"
    aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title mt-0" id="myLargeModalLabel">Buyurtmani tekshirish</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="order_view_child">

            </div>
        </div>
    </div>
</div>










<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/axios.min.js"></script>
<script>

    /* -----------------   Send message   ----------------- */
    function closeWarning() {
        location.reload()
    }

    /* -----------------   GET ALL  ----------------- */
    axios.get("/api/order/noactive")
        .then(async (res) => {
            const result = res.data.data
            let select = $(".select_group");
            await select.html("");
            result.forEach((item, index, value) => {
                select.append(
                    `<tr>
                      <td>${item.userID.fullName}</td>
                      <td>${item.order_id}</td>
                      <td id="processss"></td>
                      <td>
                          <a onclick="information_order('${item._id}')"  data-toggle="modal" data-target="#largesizemodal_inform" type="button"  class="btn btn-outline-success text-success">
                            <i class="fa fa-info-circle"></i>
                          </a>
                          <a onclick="information_order_product('${item._id}')"  data-toggle="modal" data-target="#lordered_product_inform" type="button"  class="btn btn-outline-dark text-dark">
                            <i class="fas fa-align-justify"></i>
                          </a>
                          <a onclick="access_order('${item._id}')"  data-toggle="modal" data-target="#order_view" type="button"  class="btn btn-outline-warning text-warning">
                            <i class="fas fa-eye"></i>
                          </a>
                          <a  onclick="aktiv_order('${item._id}')" type="button"     class="btn btn-outline-danger text-danger">
                            <i class="fas fa-calendar-check"></i>
                          </a>
                      </td>
                  </tr>
                  `
                );
                if (item.process == "seen") {
                    document.getElementById('processss').innerHTML = "Buyurtma tekshirilgan"
                } else {
                    document.getElementById('processss').innerHTML = "Buyurtma tekshirilmagan"
                }
            });
        });


    function aktiv_order(id) {
        axios.put(`/api/order/make_active/${id}`)
            .then((res) => {
                location.reload()
            })
    }




    // order haqida malumot olish
    function information_order(id) {
        axios.get(`/api/order/information/${id}`)
            .then(async (res) => {
                const result = res.data.data


                let select = $("#largesizemodal_inform_child")
                let ordered_product_table = $("#ordered_product_table")
                await select.html("")
                await ordered_product_table.html("")
                select.append(`
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">ID raqami</label>
                            <div class="col-sm-10">
                               <input class="form-control form-control-lg" disabled value="${result.order_id}" id="order_id" type="text">
                             </div>
                        </div>
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">Ism</label>
                            <div class="col-sm-10">
                               <input class="form-control form-control-lg" disabled value="${result.user_name}" id="user_name" type="text">
                             </div>
                        </div>
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">Familiya</label>
                            <div class="col-sm-10">
                               <input class="form-control form-control-lg" disabled value="${result.user_surname}" id="user_surname" type="text">
                             </div>
                        </div>
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">Telefon</label>
                            <div class="col-sm-10">
                               <input class="form-control form-control-lg" disabled value="${result.phone}" id="phone" type="text">
                             </div>
                        </div>
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">Manzil</label>
                            <div class="col-sm-10">
                               <input class="form-control form-control-lg" disabled value="${result.address}" id="address" type="text">
                             </div>
                        </div>
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">Jami summa</label>
                            <div class="col-sm-10">
                               <input class="form-control form-control-lg" disabled value="${result.totalPrice}" id="totalPrice" type="text">
                             </div>
                        </div>

                   ` );
            })
    }

    // buyurtma berilgan mahsulotlar
    function information_order_product(id) {
        axios.get(`/api/order/information/${id}`)
            .then(async (res) => {
                const result = res.data.data.product_ID
                let select = $("#ordered_product_table")
                await select.html("")
                result.forEach((item, index, value) => {
                    select.append(
                        `
                        <div class="form-group row">
                            <div class="col-sm-12">
                               <button data-toggle="modal" data-target="#mahsulot_modal" onclick="info_product('${item}')" class="col-sm-12 btn btn-success"><i class="far fa-eye"></i> Mahsulotni ko'rish</button>
                             </div>
                        </div>
                        `
                    );
                });
            })
    }


    // mahsulot haqida malumot
    function info_product(id) {
        axios.get(`/api/order/product/${id}`)
            .then(async (res) => {
                const result = res.data.data
                console.log(result)
                let select = $("#mahsulot_modal_child")
                await select.html("")
                select.append(
                    `
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">Mahsulot</label>
                            <div class="col-sm-10">
                               <input class="form-control form-control-lg" disabled value="${result.name.uz}" id="order_id" type="text">
                             </div>
                        </div>
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">Narx</label>
                            <div class="col-sm-10">
                               <input class="form-control form-control-lg" disabled value="${result.price}" id="order_id" type="text">
                             </div>
                        </div>
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">O'lcham</label>
                            <div class="col-sm-10">
                               <input class="form-control form-control-lg" disabled value="${result.size}" id="order_id" type="text">
                             </div>
                        </div>
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">Kategoriya</label>
                            <div class="col-sm-10">
                               <input class="form-control form-control-lg" disabled value="${result.categoryID.name.uz}" id="order_id" type="text">
                             </div>
                        </div>
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">Chegirma</label>
                            <div class="col-sm-10">
                               <input class="form-control form-control-lg" disabled value="${result.chegirma}" id="order_id" type="text">
                             </div>
                        </div>
                        <div class="form-group row">
                            <label for="example-text-input-lg" class="col-sm-2 col-form-label">Tasnif</label>
                            <div class="col-sm-10">
                                <textarea  class="form-control form-control-lg" disabled name="" id="" cols="30" rows="10">${result.description.uz}</textarea>
                             </div>
                        </div>

                        <div class="form-group row">
                            <div class="col-sm-10">
                                <img style="width: 100px;" src="${result.poster}" alt=" rasm bor">
                             </div>
                        </div>


                        `
                );
            })
    }




    function access_order(id) {
        axios.get(`/api/order/information/${id}`)
            .then(async (res) => {
                const result = res.data.data.process

                let select = $("#order_view_child")
                await select.html("")
                select.append(
                    `
                            <div class="form-group row">
                                <div class="col-sm-12 row">
                                    <button onclick="make_unseen('${id}')" class="col-sm-4 offset-1  btn btn-outline-success"><i class="fas fa-phone"></i> Tekshirilgan</button>
                                   <button onclick="make_seen('${id}')" class="col-sm-4 offset-2 btn btn-outline-danger"><i class="fas fa-phone-slash"></i> Tekshirilmagan</button>
                                 </div>
                            </div>
                        `
                );
            })
    }

    function make_unseen(id) {
        axios.put(`/api/order/make_unseen/${id}`)
            .then((res) => {
                location.reload()
            })
    }

    function make_seen(id) {
        axios.put(`/api/order/make_seen/${id}`)
            .then((res) => {
                location.reload()
            })
    }


















</script>